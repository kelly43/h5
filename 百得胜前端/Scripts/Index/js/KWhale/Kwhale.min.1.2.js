var Shape=(function(){function b(g,d,f,e){this.x=g.x;this.y=g.y;this.fillColor=e;this.strokeColor=e;this.lineWidth=1;this.type=0;this.width=d;this.height=f}b.prototype=new DisplayObject();b.prototype.draw=function(d){var e=this.UseScale();var f=this.UseAnchor();switch(this.type){case 0:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.width)/window["KWRatio"],(f.y+this.anchorY*e.height)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.rect(-this.anchorX*e.width/window["KWRatio"],-this.anchorY*e.height/window["KWRatio"],e.width/window["KWRatio"],e.height/window["KWRatio"]);d.fillStyle=this.fillColor;d.fill();d.restore();break;case 1:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.width)/window["KWRatio"],(f.y+this.anchorY*e.height)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.rect(-this.anchorX*e.width/window["KWRatio"],-this.anchorY*e.height/window["KWRatio"],e.width/window["KWRatio"],e.height/window["KWRatio"]);d.strokeStyle=this.strokeColor;d.fillStyle=this.fillColor;d.lineWidth=this.lineWidth/window["KWRatio"]*this.scale;d.stroke();d.fill();d.restore();break;case 2:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.width)/window["KWRatio"],(f.y+this.anchorY*e.height)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.rect(-this.anchorX*e.width/window["KWRatio"],-this.anchorY*e.height/window["KWRatio"],e.width/window["KWRatio"],e.height/window["KWRatio"]);d.strokeStyle=this.strokeColor;d.lineWidth=this.lineWidth/window["KWRatio"]*this.scale;d.fillStyle=this.fillColor;d.stroke();d.restore();break}};function c(f,e,d){this.x=f.x;this.y=f.y;this.fillColor=d;this.strokeColor=d;this.lineWidth=1;this.type=0;this.r=e}c.prototype=new DisplayObject();c.prototype.UseAnchor=function(){var e={x:0,y:0};var d=this.UseScale();e.x=this.x-d.r*this.anchorX;e.y=this.y-d.r*this.anchorY;return e};c.prototype.UseScale=function(){var d={r:0};d.r=this.r*this.scale;return d};c.prototype.draw=function(d){var e=this.UseScale();var f=this.UseAnchor();switch(this.type){case 0:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.r)/window["KWRatio"],(f.y+this.anchorY*e.r)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.arc(0,0,this.r/window["KWRatio"],0,Math.PI*2,true);d.fillStyle=this.fillColor;d.fill();d.restore();break;case 1:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.r)/window["KWRatio"],(f.y+this.anchorY*e.r)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.arc(0,0,this.r/window["KWRatio"],0,Math.PI*2,true);d.strokeStyle=this.strokeColor;d.lineWidth=this.lineWidth/window["KWRatio"]*this.scale;d.fillStyle=this.fillColor;d.stroke();d.fill();d.restore();break;case 2:d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.r)/window["KWRatio"],(f.y+this.anchorY*e.r)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.arc(0,0,this.r/window["KWRatio"],0,Math.PI*2,true);d.strokeStyle=this.strokeColor;d.lineWidth=this.lineWidth/window["KWRatio"]*this.scale;d.fillStyle=this.fillColor;d.stroke();d.restore();break}};function a(g,e,d,f){this.x=g.x;this.y=g.y;this.fillColor=d;this.strokeColor=d;this.lineWidth=4;this.angle=f;this.type=0;this.r=e}a.prototype=new DisplayObject();a.prototype.UseAnchor=function(){var e={x:0,y:0};var d=this.UseScale();e.x=this.x-d.r*this.anchorX;e.y=this.y-d.r*this.anchorY;return e};a.prototype.UseScale=function(){var d={r:0};d.r=this.r*this.scale;return d};a.prototype.draw=function(d){var e=this.UseScale();var f=this.UseAnchor();d.save();d.beginPath();d.globalAlpha=this.alpha;d.translate((f.x+this.anchorX*e.r)/window["KWRatio"],(f.y+this.anchorY*e.r)/window["KWRatio"]);d.rotate(this.rotation*Math.PI/180);this.showMask(d);d.arc(0,0,this.r/window["KWRatio"],0,this.angle/180*Math.PI,false);d.lineWidth=this.lineWidth/window["KWRatio"];d.lineCap="round";d.strokeStyle=this.fillColor;d.stroke();d.restore()};return{Rectangle:b,Circle:c,Arc:a}}());function RES(){}RES.RES_JSON={};RES.load=function(a,b){var f=Object.getOwnPropertyNames(RES.RES_JSON).length;var d=0;if(f==0){a(1,1);b();return}for(var h in RES.RES_JSON){var j=RES.RES_JSON[h].src;var c=function(k){var e=new Image();e.src=j;if(e.complete){RES.RES_JSON[k].isLoad=true;RES.DATA_SET[k]=e;d++;a(d,f);if(d==f){b()}return}e.onload=function(){RES.RES_JSON[k].isLoad=true;RES.DATA_SET[k]=e;d++;a(d,f);if(d==f){b()}}};try{c(h)}catch(g){console.error("err:img load:"+h)}}};RES.DATA_SET={};RES.getRES=function(a){try{if(RES.RES_JSON[a].isLoad){var b=RES.DATA_SET[a];return b}else{console.error("err:img load"+a)}}catch(c){console.error("err:img load:"+a)}};RES.getSpirteRES=function(a){if(RES.RES_JSON[a].isLoad){var b={};b.img=RES.DATA_SET[a];var c=RES.RES_JSON[a];b.action=c.action;b.res=c.res;return b}else{alert("err:img load")}};RES.getFontRES=function(a){if(RES.RES_JSON[a].isLoad){var b={};
    b.img=RES.DATA_SET[a];var c=RES.RES_JSON[a];b.res=c.frames;return b}else{alert("err:img load")}};function Line(d,c,e,a,f){var b=function(h){var g={};for(i in h){g[i]=h[i]}return g};if(f==undefined){this.startObj=b(d);this.endObj=b(c)}else{this.startObj=d;this.endObj=c}this.color=e;this.lineWidth=a;this.alpha=1}Line.prototype=new DisplayObject();Line.prototype.draw=function(a){if(this.alpha!=1){a.globalAlpha=this.alpha}a.beginPath();a.lineWidth=this.lineWidth;a.lineCap="round";a.lineJoin="round";a.strokeStyle=this.color;a.moveTo(this.startObj.x/window["KWRatio"],this.startObj.y/window["KWRatio"]);a.lineTo(this.endObj.x/window["KWRatio"],this.endObj.y/window["KWRatio"]);a.stroke()};function KWhaleAnimate(a){KWhaleAnimate.KWHAHLE_ANIMATE_SET.push(this);this.isUpdateAnimate=false;this._isRotationY=false;this._rotationY_obj={};this.stage=a}KWhaleAnimate.KWHAHLE_ANIMATE_SET=[];KWhaleAnimate.update=function(){var b=KWhaleAnimate.KWHAHLE_ANIMATE_SET;for(var c=0,a=b.length;c<a;c++){if(b[c].isUpdateAnimate){if(b[c]._isRotationY){b[c]._rotationY();console.log("j")}}}};KWhaleAnimate.prototype.start=function(){this.isUpdateAnimate=true};KWhaleAnimate.prototype.stop=function(){this.isUpdateAnimate=false};KWhaleAnimate.prototype.startRotationY=function(){this._isRotationY=true};KWhaleAnimate.prototype.stopRotationY=function(){this._isRotationY=false};KWhaleAnimate.prototype.removeRotationY=function(){this.stopRotationY();this._rotationY_obj={}};KWhaleAnimate.prototype.rotationY=function(b,c,e,d,a){this._rotationY_obj={objArr:b,stage:this.stage,r:c,MaxScale:a,rx:e,ry:d}};KWhaleAnimate.prototype._rotationY=function(){var h=this._rotationY_obj.rx;var g=this._rotationY_obj.ry;var d=this._rotationY_obj.objArr;var c=this._rotationY_obj.stage;var f=this._rotationY_obj.r;var b=this._rotationY_obj.MaxScale;for(var e=0,a=d.length;e<a;e++){d[e].x=(h+Math.sin(d[e].speed*Math.PI/180)*f);d[e].y=(g-Math.cos(d[e].speed*Math.PI/180)*f/10);d[e].z_3d=(0+Math.cos(d[e].speed*Math.PI/180)*f);d[e].speed+=(0.1);if(Math.abs(f/(f-d[e].z_3d))>b){d[e].scale=b}else{d[e].scale=Math.abs(f/(f-d[e].z_3d))}d[e].z=d[e].z_3d}};function KPhysical(b,a){this.physicalObject=a;this.displayObject=b;KPhysical.PhysicalSet.push(this)}KPhysical.PhysicalSet=[];KPhysical.prototype.runPhysical=function(){if(this.physicalObject.revolution.isRun){var a=this.physicalObject.revolution.r*2*Math.cos(this.physicalObject.revolution.angle/180*Math.PI);var b=this.physicalObject.revolution.r*2*Math.sin(this.physicalObject.revolution.angle/180*Math.PI);this.displayObject.x=a+this.physicalObject.revolution.rotationPoint.x;this.displayObject.y=b+this.physicalObject.revolution.rotationPoint.y;if(this.physicalObject.revolution.angle==360){this.physicalObject.revolution.angle=360}this.physicalObject.revolution.angle+=0.2}};KPhysical.stopPhysicalObjctByDisplayObject=function(c){for(var b=0,a=KPhysical.PhysicalSet.length;b<a;b++){if(KPhysical.PhysicalSet[b].displayObject==c){KPhysical.PhysicalSet[b].physicalObject.revolution.isRun=false}}};function KEvent(c,b,a){c.evtObject=this;c.isAutoReflash=false;this.disobj=c;this.isDestory=false;this.isAutoFreshAfterEvent=true;this.ele=document.createElement("div");this.ele.style.position="absolute";this.ele.style.top=(this.disobj.y-this.disobj.height*this.disobj.anchorY)/window["KWRatio"]+"px";this.ele.style.left=(this.disobj.x-this.disobj.width*this.disobj.anchorX)/window["KWRatio"]+"px";if(World.ISTEST){this.ele.style.backgroundColor="blue";this.ele.style.opacity="0.5"}this.ele.style.width=this.disobj.width*this.disobj.scale/window["KWRatio"]+"px";this.ele.style.height=this.disobj.height*this.disobj.scale/window["KWRatio"]+"px";document.body.appendChild(this.ele);this.times=b.times||null;KEvent.EventSet.push(this.ele);switch(b.type){case"touchstart":this.TOUCHBEGIN(a);break;case"touchend":this.TOUCHEND(a);break;case"touchmove":this.TOUCHMOVE(a);break;case"touchstartandmove":this.TOUCHBEGINANDMOVE(a);break;case"touchout":this.TOUCHOUT(a);break}}KEvent.EventSet=[];KEvent.Remove=function(c){for(var b=0,a=KEvent.EventSet.length;b<a;b++){if(KEvent.EventSet[b]==c){KEvent.EventSet.splice(b,1);a=KEvent.EventSet.length}}};KEvent.RemoveAllEventObj=function(c){for(var b=0,a=KEvent.EventSet.length;b<a;b++){var c=KEvent.EventSet[b];document.body.removeChild(c)}KEvent.EventSet=[]};KEvent.prototype.TOUCHBEGIN=function(a){var b=this;this.ele.addEventListener("touchstart",function(c){c.preventDefault();a(c);b.reflashAttribute()},false);if(World.ISTEST){this.ele.addEventListener("mousedown",function(c){a(c);b.reflashAttribute()},true)}};KEvent.prototype.TOUCHEND=function(a){var b=this;this.ele.addEventListener("touchend",function(c){c.preventDefault();a(c);b.reflashAttribute()},false);if(World.ISTEST){this.ele.addEventListener("mouseup",function(c){c.preventDefault();a(c);b.reflashAttribute()},false)}};KEvent.prototype.TOUCHMOVE=function(a){var b=this;this.ele.addEventListener("touchmove",function(c){c.preventDefault();a(c);b.reflashAttribute()},false);if(World.ISTEST){this.ele.addEventListener("mousemove",function(c){c.preventDefault();
    a(c);b.reflashAttribute()},false)}};KEvent.prototype.TOUCHOUT=function(a){var b=this;this.ele.addEventListener("touchout",function(c){c.preventDefault();a(c);b.reflashAttribute()},false);if(World.ISTEST){this.ele.addEventListener("mouseout",function(c){c.preventDefault();a(c);b.reflashAttribute()},false)}};KEvent.prototype.TOUCHBEGINANDMOVE=function(c){var d=this;var b=false;var a={};this.TOUCHBEGIN(function(){b=true;var e=d.disobj.x;var f=d.disobj.y;a={x:e,y:f};c[0]()});this.TOUCHEND(function(f){b=false;var e=d.disobj.x;var g=d.disobj.y;a={x:e,y:g};c[2]()});this.TOUCHMOVE(function(f){if(b){var e=Number(f.clientX);var j=Number(f.clientY);var h=e-a.x;var g=j-a.y;f.sx=h;f.sy=g;c[1](f)}});this.TOUCHOUT(function(f){if(b){b=false;var e=d.disobj.x;var g=d.disobj.y;a={x:e,y:g};c[2]()}})};KEvent.shakeCall;var SHAKE_THRESHOLD=500;var last_update=0;var x=y=z=last_x=last_y=last_z=0;KEvent.deviceMotionHandler=function(h){var c=h.accelerationIncludingGravity;var b=new Date().getTime();document.body.innerHTML=x+"_"+y+"_"+z;if((b-last_update)>100){var j=b-last_update;last_update=b;x=c.x;y=c.y;z=c.z;var e;var g;var f;var d;var a=Math.abs(x+y+z-last_x-last_y-last_z)/j*10000;if(a>SHAKE_THRESHOLD){KEvent.shakeCall()}last_x=x;last_y=y;last_z=z}};KEvent.ADDSHAKE=function(a){KEvent.shakeCall=a;if(window.DeviceMotionEvent){window.addEventListener("devicemotion",KEvent.deviceMotionHandler,false)}else{alert("您好，你目前所用的设置好像不支持重力感应哦！")}};KEvent.REMOVESHAKE=function(){window.removeEventListener("devicemotion",KEvent.deviceMotionHandler,false)};KEvent.prototype.destory=function(){if(!this.isDestory){this.isDestory=true;document.body.removeChild(this.ele);KEvent.Remove(this.ele)}};KEvent.prototype.reAdd=function(){if(this.isDestory){this.isDestory=false;document.body.appendChild(this.ele);KEvent.EventSet.push(this.ele)}};KEvent.prototype.reflashAttribute=function(){if(!this.isAutoFreshAfterEvent){return}this.ele.style.position="absolute";this.ele.style.top=(this.disobj.y-this.disobj.height*this.disobj.scale*this.disobj.anchorY)/window["KWRatio"]+"px";this.ele.style.left=(this.disobj.x-this.disobj.width*this.disobj.scale*this.disobj.anchorX)/window["KWRatio"]+"px";this.ele.style.width=this.disobj.width*this.disobj.scale/window["KWRatio"]+"px";this.ele.style.height=this.disobj.height*this.disobj.scale/window["KWRatio"]+"px"};KEvent.start_pos={};KEvent.end_pos={};KEvent.slideCall;KEvent.slideBegin=function(b){var d=b.touches[0];var a=Number(d.pageX);var c=Number(d.pageY);KEvent.start_pos={x:a,y:c}};KEvent.slideMove=function(b){var d=b.touches[0];var a=Number(d.pageX);var c=Number(d.pageY);KEvent.end_pos={x:a,y:c}};KEvent.slideEnd=function(a){var c=KWhaleUtils.getRotationBy2Point(KEvent.start_pos,KEvent.end_pos);var b=KWhaleUtils.distPoint(KEvent.start_pos,KEvent.end_pos);if(b>30){if(45<=c&&c<135){KEvent.slideCall("bot")}if(135<=c&&c<225){KEvent.slideCall("left")}if(225<=c&&c<315){KEvent.slideCall("top")}if(315<=c&&c<=360||0<=c&&c<45){KEvent.slideCall("right")}}};KEvent.ADDSLIDE=function(a){document.body.addEventListener("touchstart",KEvent.slideBegin,false);document.body.addEventListener("touchmove",KEvent.slideMove,false);document.body.addEventListener("touchend",KEvent.slideEnd,false);KEvent.slideCall=a};KEvent.REMOVESLIDE=function(){document.body.removeEventListener("touchstart",KEvent.slideBegin,false);document.body.removeEventListener("touchmove",KEvent.slideMove,false);document.body.removeEventListener("touchend",KEvent.slideEnd,false)};function KBox2d(b,d,a,c){this.x=0;this.y=0;this.width=0;this.height=0;this.anchorX=0;this.anchorY=0;this.scale=1;this.rotation=0;this.z=0;this.isAlive=true;this.evtObject=null;this.type=b;this.box=null;this.position=d;this.shape=a;this.disobj=c;this.init()}KBox2d.isDebug=true;KBox2d.init=function(){var b=new Box2D.Common.Math.b2Vec2(0,9.8/KWRatio);var a=true;KBox2d.scale=30;KBox2d.b2Vec2=Box2D.Common.Math.b2Vec2;KBox2d.b2BodyDef=Box2D.Dynamics.b2BodyDef;KBox2d.b2Body=Box2D.Dynamics.b2Body;KBox2d.b2FixtureDef=Box2D.Dynamics.b2FixtureDef;KBox2d.b2Fixture=Box2D.Dynamics.b2Fixture;KBox2d.b2World=Box2D.Dynamics.b2World;KBox2d.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;KBox2d.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;KBox2d.b2DebugDraw=Box2D.Dynamics.b2DebugDraw;KBox2d.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef;KBox2d.b2ContactListener=Box2D.Dynamics.b2ContactListener;KBox2d.world=new KBox2d.b2World(b,a)};KBox2d.EVTNAME={BeginContact:"BeginContact",EndContact:"EndContact",PreSolve:"PreSolve",PostSolve:"PostSolve"};KBox2d.setListener=function(b,a){var c=new KBox2d.b2ContactListener();switch(b){case"BeginContact":c.BeginContact=a;break;case"EndContact":c.EndContact=a;break;case"PreSolve":c.PreSolve=a;break;case"PostSolve":c.PostSolve=a;break}KBox2d.world.SetContactListener(c);return c};KBox2d.setupDebugDraw=function(a){if(KBox2d.isDebug){var b=new KBox2d.b2DebugDraw();b.SetSprite(a);b.SetDrawScale(KBox2d.scale);b.SetFillAlpha(1);b.SetLineThickness(1);b.SetFlags(KBox2d.b2DebugDraw.e_shapeBit|KBox2d.b2DebugDraw.e_jointBit)
}else{return}};KBox2d.worldAction=function(){var a=1/60;var c=6;var b=3;KBox2d.world.Step(a,c,b);setTimeout(KBox2d.worldAction,a)};KBox2d.prototype={init:function(){switch(this.type){case"floor":this.createFloor();break;case"rect":this.createRectBody();break;case"circle":this.createCircleBody();break}},createFloor:function(){var b=new KBox2d.b2BodyDef;b.type=KBox2d.b2Body.b2_staticBody;b.position.x=this.position.x/KWRatio/KBox2d.scale;b.position.y=this.position.y/KWRatio/KBox2d.scale;var c=new KBox2d.b2FixtureDef;c.density=1;c.friction=3;c.restitution=0.2;c.shape=new KBox2d.b2PolygonShape;c.shape.SetAsBox(this.shape.width/KWRatio/2/KBox2d.scale,this.shape.height/2/KWRatio/KBox2d.scale);var a=KBox2d.world.CreateBody(b);var d=a.CreateFixture(c);this.box={body:a,fixture:d};if(this.disobj){this.disobj.anchorX=this.disobj.anchorY=0.5;this.disobj.width=this.shape.width;this.disobj.height=this.shape.height}},createRectBody:function(){var b=new KBox2d.b2BodyDef;b.type=KBox2d.b2Body.b2_dynamicBody;b.position.x=this.position.x/KWRatio/KBox2d.scale;b.position.y=this.position.y/KWRatio/KBox2d.scale;var c=new KBox2d.b2FixtureDef;c.density=1;c.friction=1.5;c.restitution=0.4;c.shape=new KBox2d.b2PolygonShape;c.shape.SetAsBox(this.shape.width/KWRatio/KBox2d.scale,this.shape.height/KWRatio/KBox2d.scale);var a=KBox2d.world.CreateBody(b);var d=a.CreateFixture(c);this.box={body:a,fixture:d}},createCircleBody:function(){var b=new KBox2d.b2BodyDef;b.type=KBox2d.b2Body.b2_dynamicBody;b.position.x=this.position.x/KWRatio/KBox2d.scale;b.position.y=this.position.y/KWRatio/KBox2d.scale;var c=new KBox2d.b2FixtureDef;c.density=1;c.friction=3;c.restitution=0.6;c.shape=new KBox2d.b2CircleShape(this.shape.r/KWRatio/KBox2d.scale);var a=KBox2d.world.CreateBody(b);var d=a.CreateFixture(c);this.box={body:a,fixture:d};this.disobj.anchorX=this.disobj.anchorY=0.5;this.disobj.width=this.shape.r*2;this.disobj.height=this.shape.r*2},setPosY:function(a){this.box.body.SetPosition(new KBox2d.b2Vec2(this.position.x/KWRatio/KBox2d.scale,a/KWRatio/KBox2d.scale))},setPosX:function(a){this.box.body.SetPosition(new KBox2d.b2Vec2(a/KWRatio/KBox2d.scale,this.position.y/KWRatio/KBox2d.scale))},setPos:function(a,b){this.box.body.SetPosition(new KBox2d.b2Vec2(a/KWRatio/KBox2d.scale,b/KWRatio/KBox2d.scale))},getPos:function(){var a=this.box.body.GetPosition();return{x:a.x*KWRatio*KBox2d.scale,y:a.y*KWRatio*KBox2d.scale}},setSpeed:function(b,a){this.box.body.SetAwake(true);var b=b;var a=a/KWRatio/KBox2d.scale;this.box.body.SetLinearVelocity(new KBox2d.b2Vec2(a*Math.cos(b/180*Math.PI),a*Math.sin(b/180*Math.PI)));this.box.body.SetAngle(b)},addToStage:function(a){a.addChild(this.disobj)},draw:function(){var a=this.box.body.GetPosition();this.disobj.x=a.x*KWRatio*KBox2d.scale;this.disobj.y=a.y*KWRatio*KBox2d.scale;this.disobj.rotation=this.box.body.GetAngle()*180}};window["initKW"]=function(){(function(a){var d=(function(e){var f=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/f})(a),c=function(g,e){for(var f in g){if(g.hasOwnProperty(f)){e(g[f],f)}}},b={"fillRect":"all","clearRect":"all","strokeRect":"all","moveTo":"all","lineTo":"all","arc":[0,1,2],"arcTo":"all","bezierCurveTo":"all","isPointinPath":"all","isPointinStroke":"all","quadraticCurveTo":"all","rect":"all","translate":"all","createRadialGradient":"all","createLinearGradient":"all"};if(d===1){return}c(b,function(f,e){a[e]=(function(g){return function(){var k,h,j=Array.prototype.slice.call(arguments);if(f==="all"){j=j.map(function(l){return l*d})}else{if(Array.isArray(f)){for(k=0,h=f.length;k<h;k++){j[f[k]]*=d}}}return g.apply(this,j)}})(a[e])});a.stroke=(function(e){return function(){this.lineWidth*=d;e.apply(this,arguments);this.lineWidth/=d}})(a.stroke);a.fillText=(function(e){return function(){var f=Array.prototype.slice.call(arguments);f[1]*=d;f[2]*=d;this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(h,g,j){return(g*d)+j});e.apply(this,f);this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(h,g,j){return(g/d)+j})}})(a.fillText);a.strokeText=(function(e){return function(){var f=Array.prototype.slice.call(arguments);f[1]*=d;f[2]*=d;this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(h,g,j){return(g*d)+j});e.apply(this,f);this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(h,g,j){return(g/d)+j})}})(a.strokeText);window["KWRatio"]=d})(CanvasRenderingContext2D.prototype);(function(a){a.getContext=(function(b){return function(e){var f,d,c=b.call(this,e);if(e==="2d"){f=c.backingStorePixelRatio||c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;d=(window.devicePixelRatio||1)/f;if(d>1){this.style.height=this.height+"px";this.style.width=this.width+"px";this.width*=d;this.height*=d}}return c}})(a.getContext)})(HTMLCanvasElement.prototype);
    if(!window["KWRatio"]){window["KWRatio"]=1}document.body.style.overflow="hidden"};var Form=(function(){function c(e){e.ele.style.width=e.width/window["KWRatio"]*e.scale+"px";e.ele.style.height=e.height/window["KWRatio"]*e.scale+"px";e.ele.style.top=(e.y-e.height*e.anchorY*e.scale)/window["KWRatio"]+"px";e.ele.style.left=(e.x-e.width*e.anchorX*e.scale)/window["KWRatio"]+"px";e.ele.style.opacity=e.alpha;e.ele.style.fontSize=e.height/window["KWRatio"]*e.scale*0.7+"px";e.ele.style.lineHeight=e.height/window["KWRatio"]*e.scale+"px"}var b=function(e,k,f,g){this.normal_Text="";this.x=e;this.y=k;this.alpha=1;this.scale=1;this.anchorX=0;this.anchorY=0;this.width=f*this.scale;this.height=g*this.scale;this.ele=document.createElement("input");this.ele.type="text";this.ele.style.position="absolute";this.ele.style.width=this.width/window["KWRatio"]*this.scale+"px";this.ele.style.height=this.height/window["KWRatio"]*this.scale+"px";this.ele.style.top=(this.y-this.height*this.anchorY)/window["KWRatio"]+"px";this.ele.style.left=(this.x-this.width*this.anchorX)/window["KWRatio"]+"px";this.ele.style.opacity=this.alpha;this.ele.style.fontFamily="微软雅黑";this.ele.style.fontSize=(this.height/8*2.4)/window["KWRatio"]*this.scale+"px";this.ele.style.lineHeight=this.height/window["KWRatio"]*this.scale+"px";document.body.appendChild(this.ele);var j=this;this.ele.onblur=function(){if(j.ele.value==""){j.ele.value=j.normal_Text;return}else{return}};this.ele.onfocus=function(){if(j.ele.value==j.normal_Text){j.ele.value="";return}else{return}}};b.prototype.setNormalText=function(e){this.ele.placeholder=e};b.prototype.draw=function(e){c(this)};b.prototype.destroy=function(e){if(e){e.removeChild(this)}document.body.removeChild(this.ele)};b.prototype.getValue=function(){return this.ele.value};var a=function(e,k,f,g){this.normal_Text="";this.x=e;this.y=k;this.alpha=1;this.scale=1;this.anchorX=0;this.anchorY=0;this.width=f*this.scale;this.height=g*this.scale;this.ele=document.createElement("textarea");this.ele.style.position="absolute";this.ele.style.width=this.width/window["KWRatio"]*this.scale+"px";this.ele.style.height=this.height/window["KWRatio"]*this.scale+"px";this.ele.style.top=(this.y-this.height*this.anchorY)/window["KWRatio"]+"px";this.ele.style.left=(this.x-this.width*this.anchorX)/window["KWRatio"]+"px";this.ele.style.opacity=this.alpha;this.ele.style.fontFamily="微软雅黑";document.body.appendChild(this.ele);var j=this;this.ele.onblur=function(){if(j.ele.value==""){j.ele.value=j.normal_Text;return}else{return}};this.ele.onfocus=function(){if(j.ele.value==j.normal_Text){j.ele.value="";return}else{return}}};a.prototype.setFontSize=function(e){this.ele.style.fontSize=e/window["KWRatio"]*this.scale+"px"};a.prototype.setNormalText=function(e){this.normal_Text=e;this.ele.value=e};a.prototype.draw=function(e){c(this)};a.prototype.destroy=function(e){if(e){e.removeChild(this)}document.body.removeChild(this.ele)};a.prototype.getValue=function(){return this.ele.value};var d=function(e,j,f,g){this.x=e;this.y=j;this.alpha=1;this.scale=1;this.anchorX=0;this.anchorY=0;this.width=f*this.scale;this.height=g*this.scale;this.ele=document.createElement("select");this.ele.style.position="absolute";this.ele.style.width=this.width/window["KWRatio"]*this.scale+"px";this.ele.style.height=this.height/window["KWRatio"]*this.scale+"px";this.ele.style.top=(this.y-this.height*this.anchorY)/window["KWRatio"]+"px";this.ele.style.left=(this.x-this.width*this.anchorX)/window["KWRatio"]+"px";this.ele.style.opacity=this.alpha;this.ele.style.fontFamily="微软雅黑";this.ele.style.fontSize=(this.height/8*2.4)/window["KWRatio"]*this.scale+"px";this.ele.style.lineHeight=this.height/window["KWRatio"]*this.scale+"px";document.body.appendChild(this.ele)};d.prototype.setItem=function(f){this.ele.innerHTML="";for(var g=0,e=f.length;g<e;g++){var h=document.createElement("option");h.text=f[g];this.ele.appendChild(h)}};d.prototype.draw=function(e){c(this)};d.prototype.destroy=function(e){e.removeChild(this);document.body.removeChild(this.ele)};return{Text:b,Select:d,Textarea:a}}());function DisplayObject(){this.x=0;this.y=0;this.width=0;this.height=0;this.anchorX=0;this.anchorY=0;this.scale=1;this.rotation=0;this.z=0;this.isAlive=true;this.evtObject=null;this.mask=null}DisplayObject.prototype.showMask=function(a){if(this.mask){if(this.mask.type=="arc"){a.beginPath();if(this.mask.pos){a.arc(this.mask.pos.x,this.mask.pos.y,this.mask.r/window["KWRatio"],0,Math.PI*2)}else{a.arc(0,0,this.mask.r/window["KWRatio"],0,Math.PI*2)}a.closePath()}a.clip()}};DisplayObject.prototype.draw=function(a){};DisplayObject.prototype.setZ=function(b,a){this.z=b;a.reflashZ()};DisplayObject.prototype.setAnchor=function(a){this.anchorX=a;this.anchorY=a};DisplayObject.prototype.UseAnchor=function(){var b={x:0,y:0};var a=this.UseScale();b.x=this.x-a.width*this.anchorX;b.y=this.y-a.height*this.anchorY;return b};DisplayObject.prototype.setScale=function(a){this.scale=a};DisplayObject.prototype.UseScale=function(){var a={height:0,width:0};
    a.width=this.width*this.scale;a.height=this.height*this.scale;return a};function BitmapFont(a,b){this.number=a||0;this.img=b.img;this.res=b.res;this.width=b.res["0"]["w"];this.height=b.res["0"]["h"];this.proportion=this.width/this.height}BitmapFont.prototype=new DisplayObject();BitmapFont.prototype.draw=function(a){var c=this.UseScale();var e=this;var h=e.number+"";var b=h.length;for(var d=0;d<b;d++){a.save();a.globalAlpha=e.alpha;a.rotate(e.rotation*Math.PI/180);a.translate((e.x-e.anchorX*c.width*b)/window["KWRatio"],(e.y-e.anchorY*c.height)/window["KWRatio"]);var g=h[d];var f=e.res[g];a.drawImage(e.img,f.x,f.y,f.w,f.h,c.width*d,0,c.width,c.height);a.restore()}};function Bitmap(a){this.img=a;this.width=a.width;this.height=a.height;this.proportion=a.width/a.height;this.alpha=1;this.is3D=false;this.z_3d=0;this.z_r=100}Bitmap.prototype=new DisplayObject();Bitmap.prototype.draw=function(j){if(this.is3D){this.scale=Math.abs(this.z_r/(this.z_r-this.z_3d))}var h=this.UseScale();var g=this.UseAnchor();var f=this.img;var e=this.rotation;var c=this.anchorX;var b=this.anchorY;var d=this.alpha;j.save();var a=1;if(this.scale==-1){j.scale(-1,1);a=-1}if(d!=1){j.globalAlpha=d}j.translate((g.x*a+c*h.width*a)/window["KWRatio"],(g.y+b*h.height)/window["KWRatio"]);if(e!=1){j.rotate(e*Math.PI/180)}this.showMask(j);j.drawImage(f,-c*h.width,-b*h.height,h.width,h.height);j.restore()};(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());function World(){}World.FPS=0;World.isShowFPS=false;World.ISTEST=false;World.STAT;World.init=function(){window["initKW"]()};World.Go=function(a){if(World.isShowFPS){World.STAT=new Stats();document.body.appendChild(World.STAT.domElement)}(function b(){if(World.isShowFPS){World.STAT.begin();window.requestAnimationFrame(b);World.STAT.end();a()}else{window.requestAnimationFrame(b);a()}}())};var KWhaleUtils=(function(){var d=function(A,s,t,q,r){var v={};for(var p in s){v[p]=A[p]}var u=new TWEEN.Tween(A).to(s,q).delay(t).easing(r);var w=new TWEEN.Tween(A).to(v,q).delay(t).easing(r);u.chain(w);w.chain(u);return u};var o=function(p,t,q,s,u){var r=new TWEEN.Tween(p).to(t,s).delay(q).repeat(Infinity).easing(u);return r};var k=function(p,t,q,s,u){var r=new TWEEN.Tween(p).delay(q).to(t,s).easing(u);return r};var l=function(p,r,q){if(r.proportion){r.height=p.sh*q;r.width=r.height*r.proportion;if(r.width>p.sw){r.width=p.sw;r.height=r.width/r.proportion}p.addChild(r)}};var m=function(p,r,q){if(r.proportion){r.width=p.sw*q;r.height=r.width/r.proportion;p.addChild(r)}};var j=function(p,r,q){if(r.proportion){r.height=p.sh*q;r.width=r.height*r.proportion;p.addChild(r)}};var c=function(p){return Math.abs(Math.ceil(Math.random()*p))};var b=function(s,q,r){var p=s.x+2*r*Math.cos(q/180*Math.PI);var t=s.y+2*r*Math.sin(q/180*Math.PI);return{"x":Math.ceil(p),"y":Math.ceil(t)}};var a=function(q,p){return Math.sqrt((q.x-p.x)*(q.x-p.x)+(q.y-p.y)*(q.y-p.y))};var f=function(s,r){var q=s.x-r.x,p=s.y-r.y;return Math.atan2(p,q)*180/Math.PI+180};var h=function(t,u,r,q,p){var v=document.createElement("div");v.style.position="absolute";if(u!="auto"){v.style.height=t.sh*u/window["KWRatio"]+"px"}if(r!="auto"){v.style.width=t.sh*r/window["KWRatio"]+"px"}v.style.top=t.sh*q/window["KWRatio"]+"px";v.style.fontFamily="微软雅黑";v.innerHTML=p;document.body.appendChild(v);return v};var g=function(r,q){var p=new Image();p.src=r;p.onload=function(){q(p)}};var n=function(r,t){var s=window.innerHeight||document.documentElement.clientHeight;var p=window.innerWidth||document.documentElement.clientWidth;var q=new Shape.Rectangle({x:0,y:0},p*window["KWRatio"],s*window["KWRatio"],r);q.alpha=t;return q};var e=function(q){var p=new Bitmap(RES.getRES(q));p.anchorX=0.5;return p};return{Tween_YoYo:d,AddStageByScaleH:l,Tween_Loop:o,Tween:k,AddStageByScaleHNoCheck:j,getRandomOne2Numer:c,getPointByRotationAndPointAndLineWidth:b,getRotationBy2Point:f,distPoint:a,addDomByScale:h,getImgBySrcAndCall:g,AddStageByScaleWNoCheck:m,getMask:n,getBmpByName:e}}());void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var a=[];return{REVISION:"14",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},update:function(b){if(0===a.length){return !1}var c=0;for(b=void 0!==b?b:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();c<a.length;){a[c].update(b)?c++:a.splice(c,1)
    }return !0}}}();TWEEN.Tween=function(H){var B=H,D={},K={},q={},G=1000,P=0,S=!1,N=!1,R=!1,C=0,L=null,J=TWEEN.Easing.Linear.None,F=TWEEN.Interpolation.Linear,A=[],Q=null,m=!1,j=null,k=null,g=null;for(var b in H){D[b]=parseFloat(H[b],10)}this.to=function(c,a){return void 0!==a&&(G=a),K=c,this},this.start=function(c){TWEEN.add(this),N=!0,m=!1,L=void 0!==c?c:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),L+=C;for(var a in K){if(K[a] instanceof Array){if(0===K[a].length){continue}K[a]=[B[a]].concat(K[a])}D[a]=B[a],D[a] instanceof Array==!1&&(D[a]*=1),q[a]=D[a]||0}return this},this.stop=function(){return N?(TWEEN.remove(this),N=!1,null!==g&&g.call(B),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var c=0,a=A.length;a>c;c++){A[c].stop()}},this.delay=function(a){return C=a,this},this.repeat=function(a){return P=a,this},this.yoyo=function(a){return S=a,this},this.easing=function(a){return J=a,this},this.interpolation=function(a){return F=a,this},this.chain=function(){return A=arguments,this},this.onStart=function(a){return Q=a,this},this.onUpdate=function(a){return j=a,this},this.onComplete=function(a){return k=a,this},this.onStop=function(a){return g=a,this},this.update=function(c){var o;if(L>c){return !0}m===!1&&(null!==Q&&Q.call(B),m=!0);var r=(c-L)/G;r=r>1?1:r;var l=J(r);for(o in K){var d=D[o]||0,p=K[o];p instanceof Array?B[o]=F(p,l):("string"==typeof p&&(p=d+parseFloat(p,10)),"number"==typeof p&&(B[o]=d+(p-d)*l))}if(null!==j&&j.call(B,l),1==r){if(P>0){isFinite(P)&&P--;for(o in q){if("string"==typeof K[o]&&(q[o]=q[o]+parseFloat(K[o],10)),S){var e=q[o];q[o]=K[o],K[o]=e}D[o]=q[o]}return S&&(R=!R),L=c+C,!0}null!==k&&k.call(B);for(var h=0,a=A.length;a>h;h++){A[h].start(c)}return !1}return !0}},TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?0.5*a*a:-0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return --a*a*a+1},InOut:function(a){return(a*=2)<1?0.5*a*a*a:0.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return --a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return 0.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(d){var b,c=0.1,a=0.4;return 0===d?0:1===d?1:(!c||1>c?(c=1,b=a/4):b=a*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(d-=1))*Math.sin(2*(d-b)*Math.PI/a)))},Out:function(d){var b,c=0.1,a=0.4;return 0===d?0:1===d?1:(!c||1>c?(c=1,b=a/4):b=a*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*d)*Math.sin(2*(d-b)*Math.PI/a)+1)},InOut:function(d){var b,c=0.1,a=0.4;return 0===d?0:1===d?1:(!c||1>c?(c=1,b=a/4):b=a*Math.asin(1/c)/(2*Math.PI),(d*=2)<1?-0.5*c*Math.pow(2,10*(d-=1))*Math.sin(2*(d-b)*Math.PI/a):c*Math.pow(2,-10*(d-=1))*Math.sin(2*(d-b)*Math.PI/a)*0.5+1)}},Back:{In:function(b){var a=1.70158;return b*b*((a+1)*b-a)},Out:function(b){var a=1.70158;return --b*b*((a+1)*b+a)+1},InOut:function(b){var a=2.5949095;return(b*=2)<1?0.5*b*b*((a+1)*b-a):0.5*((b-=2)*b*((a+1)*b+a)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+0.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375},InOut:function(a){return 0.5>a?0.5*TWEEN.Easing.Bounce.In(2*a):0.5*TWEEN.Easing.Bounce.Out(2*a-1)+0.5}}},TWEEN.Interpolation={Linear:function(f,c){var d=f.length-1,b=d*c,a=Math.floor(b),e=TWEEN.Interpolation.Utils.Linear;return 0>c?e(f[0],f[1],b):c>1?e(f[d],f[d-1],d-b):e(f[a],f[a+1>d?d:a+1],b-a)},Bezier:function(h,c){var d,b=0,a=h.length-1,g=Math.pow,f=TWEEN.Interpolation.Utils.Bernstein;for(d=0;a>=d;d++){b+=g(1-c,a-d)*g(c,d)*h[d]*f(a,d)}return b},CatmullRom:function(f,c){var d=f.length-1,b=d*c,a=Math.floor(b),e=TWEEN.Interpolation.Utils.CatmullRom;return f[0]===f[d]?(0>c&&(a=Math.floor(b=d*(1+c))),e(f[(a-1+d)%d],f[a],f[(a+1)%d],f[(a+2)%d],b-a)):0>c?f[0]-(e(f[0],f[0],f[1],f[1],-b)-f[0]):c>1?f[d]-(e(f[d],f[d],f[d-1],f[d-1],b-d)-f[d]):e(f[a?a-1:0],f[a],f[a+1>d?d:a+1],f[a+2>d?d:a+2],b-a)},Utils:{Linear:function(c,a,b){return(a-c)*b+c},Bernstein:function(c,a){var b=TWEEN.Interpolation.Utils.Factorial;return b(c)/b(a)/b(c-a)},Factorial:function(){var a=[1];return function(c){var d,b=1;
    if(a[c]){return a[c]}for(d=c;d>1;d--){b*=d}return a[c]=b}}(),CatmullRom:function(d,m,b,g,l){var c=0.5*(b-d),j=0.5*(g-m),k=l*l,h=l*k;return(2*m-2*b+c+j)*h+(-3*m+3*b-2*c-j)*k+c*l+m}}},"undefined"!=typeof module&&module.exports&&(module.exports=TWEEN);function Stage(a){a.height=window.innerHeight||document.documentElement.clientHeight;a.width=window.innerWidth||document.documentElement.clientWidth;this.ctx=a.getContext("2d");this.isAction=true;this.displayObjectSet=[];this.canvas=a;this.sw=a.width;this.sh=a.height;this.rate=0;this.rateCount=0}Stage.prototype.removeAllDisplayObject=function(){this.displayObjectSet=[]};Stage.prototype.worldDraw=function(){if(this.isAction){this.rateCount++;if(this.rateCount>=this.rate){this.rateCount=0;this.canvas.width=this.canvas.width;var d=this.displayObjectSet;for(var b=0,c=d.length;b<c;b++){var k=d[b];if(k.isAlive){var g=k.anchorX;if(g==0){g=1}var f=k.anchorY;if(f==0){f=1}if(k.alpha!=0){k.draw(this.ctx)}if(k.isAutoReflash){k.evtObject.reflashAttribute()}}}var e=KPhysical.PhysicalSet;if(e.length>0){for(var a=0,h=e.length;h>0&&a<h;a++){e[a].runPhysical()}}}}};Stage.DISPLAY_OBJECT_COUNT=0;Stage.prototype.addChild=function(a){a.z=Stage.DISPLAY_OBJECT_COUNT;Stage.DISPLAY_OBJECT_COUNT++;this.displayObjectSet.push(a)};Stage.prototype.removeChild=function(c){var d=this.displayObjectSet;for(var b=0,a=d.length;b<a;b++){if(d[b]==c){this.displayObjectSet.splice(b,1);Stage.DISPLAY_OBJECT_COUNT--}}};Stage.prototype.reflashZ=function(){var e=this.displayObjectSet;for(var d=0,a=e.length;d<a;d++){for(var c=d+1,a=e.length;c<a;c++){if(e[d].z>e[c].z){var b=e[c];e[c]=e[d];e[d]=b}}}};function Text(d,a,c,b){this.text=d;this.fontFamily=a;this.fontSize=c;this.color=b;this.ele=null;this.bold="";this.getRealSize()}Text.prototype=new DisplayObject();Text.prototype.getRealSize=function(){if(World.ISTEST){console.log("Text is no suppor the attribute of 'anchor'and 'scale'")}this.ele=document.createElement("span");this.ele.style.position="absolute";this.ele.style.backgroundColor="red";this.ele.style.fontFamily=this.fontFamily;this.ele.style.fontSize=this.fontSize/window["KWRatio"]+"px";this.ele.style.lineHeight=this.fontSize/window["KWRatio"]+"px";this.ele.innerHTML=this.text;document.body.appendChild(this.ele);this.width=this.ele.offsetWidth*window["KWRatio"];this.height=this.ele.offsetHeight*window["KWRatio"];document.body.removeChild(this.ele);this.ele=null};Text.prototype.UseAnchor=function(){var a={x:0,y:0};a.x=this.x;a.y=this.y;return a};Text.prototype.draw=function(a){var b={x:0,y:0};b.x=this.x;b.y=this.y;a.save();a.globalAlpha=this.alpha;a.translate((b.x)/window["KWRatio"],(b.y)/window["KWRatio"]);a.rotate(this.rotation*Math.PI/180);a.font=this.bold+" "+(this.fontSize/window["KWRatio"])+"px "+this.fontFamily;a.fillStyle=this.color;a.fillText(this.text,0,0);a.restore()};function Spirte(c,b){this.img=c.img;this.res=c.res;this.action=c.action;for(var a in c.res){this.width=c.res[a]["w"];this.height=c.res[a]["h"];this.proportion=this.width/this.height;break}this.curAction=b;this.curActionIndex=0;this.countRate=0;this.alpha=1;this.isplay=true;this.isplayOne=false;this.isCall=false;this.callFunc=null;this.clipImg()}Spirte.prototype=new DisplayObject();Spirte.prototype.clipImg=function(){var d=this;d.clipImgSet={};for(var b in d.res){var c=document.createElement("canvas");var e=d.res[b];c.width=e.w/KWRatio;c.height=e.h/KWRatio;var a=c.getContext("2d");a.drawImage(d.img,e.x,e.y,e.w,e.h,0,0,e.w,e.h);d.clipImgSet[b]=c}};Spirte.prototype.draw=function(a){var b=this.UseScale();var f=this.UseAnchor();var c=this;a.save();a.globalAlpha=c.alpha;a.translate(Math.floor((f.x+c.anchorX*b.width)/window["KWRatio"]),Math.floor((f.y+c.anchorY*b.height)/window["KWRatio"]));a.rotate(c.rotation*Math.PI/180);var e=c.action[c.curAction].frameRate;c.countRate++;var d;if(c.isplay){if(c.isplayOne){if(c.countRate>=(60/e)){c.countRate=0;if(c.action[c.curAction]["frames"].length-1>c.curActionIndex){d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]];c.curActionIndex++}else{if(c.action[c.curAction]["frames"].length-1==c.curActionIndex){if(!c.isCall){c.isCall=true;c.curActionIndex=c.action[c.curAction]["frames"].length-1;if(c.callFunc){c.callFunc()}}c.isplayOne=false;c.isplay=false;d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}}}else{d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}}else{if(c.countRate>=(60/e)){c.countRate=0;if(c.action[c.curAction]["frames"].length-1>c.curActionIndex){d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]];c.curActionIndex++}else{c.curActionIndex=0;d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}}else{d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}}}else{d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}if(!d){c.curActionIndex=0;d=c.clipImgSet[c.action[c.curAction]["frames"][c.curActionIndex]]}a.drawImage(d,-Math.floor(c.anchorX*b.width),-Math.floor(c.anchorY*b.height),Math.floor(b.width),Math.floor(b.height));
    a.restore()};Spirte.prototype.play=function(a){this.curAction=a;this.isplay=true};Spirte.prototype.playOne=function(a){this.curAction=a;this.isplay=true;this.isplayOne=true};Spirte.prototype.stop=function(){this.isplay=false};Spirte.prototype.stopAt=function(a){this.stop();this.curActionIndex=a};