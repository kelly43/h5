///<jscompress sourcefile="gc.js" />
///<jscompress sourcefile="island.js" />
/**
 * Created by Administrator on 2016/5/19.
 */

//小岛
///<jscompress sourcefile="bird.js" />
/**
 * Created by Administrator on 2016/5/19.
 */

//海鸥
///<jscompress sourcefile="eagle.js" />
/**
 * Created by Administrator on 2016/5/19.
 */

//老鹰
function GC(a,b,c){this._stage_bg=a;this._stage_main=b;this._stage_top=c;this._common=new HotyiCommon(this);this._targetScore=window.GameScore||10;this._score=0;this._isTest=!1;this._scene=null;this._isGameOver=this._isGameStart=!1;this._panel=new Panel(this);this._islandNum=3;this._allIsland=6;this._speed=1800;this.gameInit()}GC.IsGameOver=!1;GC.prototype={gameInit:function(){this._panel.showStartPanel()},gameStart:function(){this._isGameStart||(this._isGameStart=!0,window.isPreventDefault=!1,this._scene=new Scene(this))},gameOver:function(){if(!this._isGameOver){this._isGameOver=!0;window.isPreventDefault=!0;this._targetScore<=this._score?this._common.showSuccessPanel(this._score):this._common.showDefeatPanel(this._score);for(var a=0;3>a;a++)Island.IslandSet[a]._spinning&&Island.IslandSet[a]._spinning.stop()}},gameReplay:function(){this.clearAllStage();this.gameStart()},clearAllStage:function(){this._stage_main.displayObjectSet=[];this._stage_bg.displayObjectSet=[];this._stage_top.displayObjectSet=[];KEvent.RemoveAllEventObj();this._isGameOver=this._isGameStart=!1;this._score=0;Island.IslandSet=[];Island.LeftOrRight=!1;this._scene=null;this._speed=1200}};function Panel(a){this._gc=a}Panel.prototype={_Bg:null,_p1BeginBtn:null,_p1Title:null,_p1Score:null,_bird:null,_p1ScoreText:null,_list:null,_rule:null,_logo:null,showStartPanel:function(){var a=this,b=a._gc._stage_bg,c=a._gc._stage_top;a._Bg=a.createBitmap("bg",b,1,b.sw/2,b.sh/2);a._p1Title=a.createBitmap("title",c,126/1135,c.sw/2,c.sh/1135*205);a._p1Score=a.createBitmap("score1",c,84/1135,c.sw/2,c.sh/1135*348);a._bird=a.createBitmap("sea_gull1",c,292/1135,c.sw/2,c.sh/1135*563);a._p1BeginBtn=a.createBitmap("begin_btn",c,145/1135,c.sw/2,c.sh/1135*828);a._list=a.createBitmap("list",c,102/1135,c.sw/2,c.sh/1135*966);a._rule=a.createBitmap("rule",c,90/1135,c.sw/2+c.sh/1135*274,c.sh/1135*75);a._rule.scale=.9;a._rule.rotation=1;KWhaleUtils.Tween_YoYo(a._rule,{scale:1.2,rotation:360},400,1200,TWEEN.Easing.Linear.None).start();a._logo=new Bitmap(RES.getRES("logo"));KWhaleUtils.AddStageByScaleHNoCheck(c,a._logo,90/1135);a._logo.x=stop.sw/2-stop.sh/1135*360;a._logo.y=0;a._gc._common.getHighScore(function(b){a._p1ScoreText=new Text(b+"","Arial",c.sh/200*9,"#23a2e4");a._p1ScoreText.y=a._p1Score.y+a._p1ScoreText.height/3;a._p1ScoreText.x=c.sw/2+c.sh/1135*50;c.addChild(a._p1ScoreText)});new KEvent(a._p1BeginBtn,{type:"touchstart"},function(){a._p1BeginBtn.evtObject.destory();a.hideStartPanel();a.explainPanel()});new KEvent(a._list,{type:"touchstart"},function(){a._gc._common.showRankingList()});new KEvent(a._rule,{type:"touchstart"},function(){a._gc._common.showRulePanel()})},hideStartPanel:function(){var a=this._gc._stage_top;a.removeChild(this._p1BeginBtn);a.removeChild(this._p1Title);a.removeChild(this._p1Score);a.removeChild(this._bird);a.removeChild(this._list);a.removeChild(this._rule);a.removeChild(this._logo);a.removeChild(this._p1ScoreText);this._list.evtObject.destory();this._rule.evtObject.destory()},_explainBg:null,_explainImg:null,_explainIndex:1,explainPanel:function(){var a=this,b=a._gc._stage_bg,c=a._gc._stage_top;a._explainBg=new Shape.Rectangle({x:c.sw/2,y:c.sh/2},c.sw,c.sh,"rgba(0,0,0,.8)");a._explainBg.anchorX=a._explainBg.anchorY=.5;c.addChild(a._explainBg);a._explainImg=a.createBitmap("explain1",c,781/1135,c.sw/2,c.sh/2);new KEvent(a._explainBg,{type:"touchstart"},function(){a._explainIndex++;3>=a._explainIndex&&(a._explainImg.img=RES.getRES("explain"+a._explainIndex));3<a._explainIndex&&(a._explainBg.evtObject.destory(),c.removeChild(a._explainBg),c.removeChild(a._explainImg),b.removeChild(a._Bg),a._gc.gameStart())})},_scoreImg:null,_scoreText:null,gameScore:function(){var a=this._gc._stage_top;this._scoreImg=this.createBitmap("score2",a,88/1135,a.sw/2,a.sh/1135*80);this._scoreText=new Text(this._gc._score,"Arial",a.sh/200*9,"#23a2e4");this._scoreText.y=this._scoreImg.y+this._p1ScoreText.height/3;this._scoreText.x=a.sw/2+a.sh/1135*35;a.addChild(this._scoreText)},resetScore:function(){this._scoreText.text=this._gc._score},hideGameScore:function(){var a=this._gc._stage_top;a.removeChild(this._scoreImg);a.removeChild(this._scoreText)},createBitmap:function(a,b,c,d,e){a=new Bitmap(RES.getRES(""+a));KWhaleUtils.AddStageByScaleHNoCheck(b,a,c);a.anchorX=a.anchorY=.5;a.x=d;a.y=e;return a}};function Scene(a){this._gc=a;this._eagle=this._bird=null;this._addScore=1;this.init()}Scene.prototype={_Bg:null,init:function(){var a=this,b=a._gc._stage_main;a._Bg=a._gc._panel.createBitmap("bg2",b,1,b.sw/2,b.sh/2);a._gc._panel.gameScore();for(var c=0;3>c;c++)new Island(a._gc,c,b.sw/2,b.sh/1135*(860-530*c));a._bird=new Bird(a._gc);a._eagle=new Eagle(a._gc);new KEvent(a._Bg,{type:"touchstart"},function(){a._Bg.evtObject.destory();a._bird.fly()})}};function Island(a,b,c,d){this._gc=a;this._type=0;this._bitmap=this._wind=null;this._angle=[140,210,320,30];this._pointSet=[];this._flood=[];this.slideDown=this._water=null;Island.IslandSet.push(this);this.init(b,c,d)}Island.IslandSet=[];Island.LeftOrRight=!1;Island.prototype={init:function(a,b,c){var d=this._gc._stage_main;Island.LeftOrRight?(Island.LeftOrRight=!1,b+=d.sh/1135*150):(Island.LeftOrRight=!0,b-=d.sh/1135*150);this._bitmap=this._gc._panel.createBitmap("island"+(a+1),d,277/1135,b,c);this._wind=this._gc._panel.createBitmap("wind4",d,392/1135,this._bitmap.x,this._bitmap.y)},slide:function(a){var b=this,c=b._gc._stage_main,d=!0,e={posY:0,islandY:b._bitmap.y,birdY:b._gc._scene._bird._bitmap.y,eagleY:b._gc._scene._eagle._bitmap.y};b.slideDown=KWhaleUtils.Tween(e,{posY:c.sh/1135*530},0,300,TWEEN.Easing.Linear.None).start().onUpdate(function(){b._bitmap.y=e.islandY+e.posY;b._wind.y=e.islandY+e.posY;b._gc._scene._bird._bitmap.y=e.birdY+e.posY;b._gc._scene._eagle._bitmap.y=e.eagleY+e.posY;for(ele in b._flood)b._flood[ele]&&(b._flood[ele].y=e.islandY+e.posY)}).onComplete(function(){d&&(d=!1,b._bitmap.y>c.sh&&(b.reset(a),b._gc._scene._bird.targetOrCurIsland(),b._gc._scene._bird._curIsland.flood()),b._gc._scene._Bg.evtObject.reAdd())})},_floodInterval:null,flood:function(){var a=this,b=a._gc._stage_main,c=1;a._floodInterval=setInterval(function(){if(!a._gc._scene._bird._isFly){var d=a._gc._panel.createBitmap("wave",b,281/1135,a._bitmap.x,a._bitmap.y);d.scale=c;.3>=c?(b.removeChild(a._bitmap),a._gc._scene._bird.die(0)):c-=.1;a._flood.push(d)}},600)},_spinning:null,reset:function(a){var b=Island.IslandSet.splice(a,1)[0],c=b._gc._stage_main;a=c.sw/2;for(ele in b._flood)b._flood[ele]&&c.removeChild(b._flood[ele]);b._flood.length=0;Island.LeftOrRight?(Island.LeftOrRight=!1,a+=c.sh/1135*150):(Island.LeftOrRight=!0,a-=c.sh/1135*150);b._gc._islandNum>=b._gc._allIsland?b._gc._islandNum=1:b._gc._islandNum++;b._bitmap.img=RES.getRES("island"+b._gc._islandNum);b._bitmap.y=-c.sh/1135*200;b._bitmap.x=a;10<=b._gc._score?(b._gc._speed-=30,a=KWhaleUtils.getRandomOne2Numer(3)):(b._gc._speed-=40,a=KWhaleUtils.getRandomOne2Numer(2));b._type=a;b._wind=b._gc._panel.createBitmap("wind"+a,c,392/1135,b._bitmap.x,b._bitmap.y);a=function(a){var d=new Shape.Circle(b.getPointByAngle(b._bitmap,b._angle[a]+b._wind.rotation),c.sh/1135*10,"rgba(0,0,0,0)");d._angle=b._angle[a];b._pointSet.push(d);c.addChild(d)};var d={},e=function(a){b._pointSet[a]._pointAngle=b._pointSet[a]._angle+b._wind.rotation;360<b._pointSet[a]._pointAngle&&(b._pointSet[a]._pointAngle-=360);d["p"+a]=b.getPointByAngle(b._bitmap,b._pointSet[a]._pointAngle);b._pointSet[a].x=d["p"+a].x;b._pointSet[a].y=d["p"+a].y};switch(b._type){case 1:for(var f=0;2>f;f++)a(f);b._spinning=KWhaleUtils.Tween_Loop(b._wind,{rotation:360},0,b._gc._speed,TWEEN.Easing.Linear.None).start().onUpdate(function(){for(var a=0;2>a;a++)e(a)});break;case 2:for(f=0;4>f;f++)a(f);b._spinning=KWhaleUtils.Tween_Loop(b._wind,{rotation:360},0,b._gc._speed,TWEEN.Easing.Linear.None).start().onUpdate(function(){for(var a=0;4>a;a++)e(a)});break;case 3:a(0),a(3),b._spinning=KWhaleUtils.Tween_Loop(b._wind,{rotation:360},0,b._gc._speed,TWEEN.Easing.Linear.None).start().onUpdate(function(){for(var a=0;2>a;a++)e(a)})}Island.IslandSet.push(b)},getPointByAngle:function(a,b){var c=this._gc._stage_main.sh/1135*196;return{x:a.x+c*Math.cos(b/180*Math.PI),y:a.y+c*Math.sin(b/180*Math.PI)}}};function Bird(a){this._gc=a;this._curIsland=this._targetIsland=this._bitmap=null;this._flyBack=this._isFly=!1;this.init()}Bird.prototype={init:function(){var a=this._gc._stage_top;this._curIsland=Island.IslandSet[0];this._targetIsland=Island.IslandSet[1];this._bitmap=this._gc._panel.createBitmap("sea_gull1",a,105/1135,this._curIsland._bitmap.x,this._curIsland._bitmap.y);this._bitmap.scale=-1},targetOrCurIsland:function(){this._curIsland=this._targetIsland;this._targetIsland=Island.IslandSet[1]},_animateBird:null,_flyBackAnimate:null,flyBack:function(){var a=this,b=a._gc._stage_main;a._animateBird.stop();a._flyBack=!0;a._flyBackAnimate=KWhaleUtils.Tween(a._bitmap,{y:a._curIsland._bitmap.y,x:a._curIsland._bitmap.x},0,300,TWEEN.Easing.Linear.None).start().onComplete(function(){a._flyBack=!1;a._bitmap.scale=a._curIsland._bitmap.x<b.sw/2?-1:1;a._bitmap.img=RES.getRES("sea_gull1");a._isFly=!1;a._gc._scene._Bg.evtObject.reAdd()})},fly:function(){var a=this,b=a._gc._stage_main,c=!1,d=0;a._isFly=!0;a._animateBird=KWhaleUtils.Tween(a._bitmap,{y:a._targetIsland._bitmap.y,x:a._targetIsland._bitmap.x},0,500,TWEEN.Easing.Linear.None).start().onUpdate(function(){a._bitmap.img=RES.getRES("sea_gull2");d=KWhaleUtils.getRotationBy2Point(a._targetIsland._bitmap,a._curIsland._bitmap);if(KWhaleUtils.distPoint(a._bitmap,a._targetIsland._bitmap)<=b.sh/1135*240&&KWhaleUtils.distPoint(a._bitmap,a._targetIsland._bitmap)>=b.sh/1135*100)switch(a._targetIsland._type){case 1:a._targetIsland._pointSet[1]._pointAngle>=d&&70>=a._targetIsland._pointSet[1]._pointAngle-d&&a.flyBack();break;case 2:(a._targetIsland._pointSet[1]._pointAngle>=d&&70>=a._targetIsland._pointSet[1]._pointAngle-d||a._targetIsland._pointSet[3]._pointAngle>=d&&70>=a._targetIsland._pointSet[3]._pointAngle-d)&&a.flyBack();break;case 3:switch(a._targetIsland._bitmap.x>b.sw/2){case !0:(a._targetIsland._pointSet[1]._pointAngle>=d||9>=a._targetIsland._pointSet[1]._pointAngle)&&a.flyBack();break;case !1:a._targetIsland._pointSet[1]._pointAngle>=d&&310>=a._targetIsland._pointSet[1]._pointAngle&&a.flyBack()}}}).onComplete(function(){if(!c){c=!0;a._gc._score+=a._gc._scene._addScore;a._gc._panel.resetScore();a._bitmap.scale=a._targetIsland._bitmap.x<b.sw/2?-1:1;a._bitmap.img=RES.getRES("sea_gull1");clearInterval(a._curIsland._floodInterval);var d=setTimeout(function(){clearTimeout(d);for(var c=0;3>c;c++)Island.IslandSet[c].slide(c);if(a._targetIsland._spinning){for(ele in a._targetIsland._pointSet)a._targetIsland._pointSet[ele]&&b.removeChild(a._targetIsland._pointSet[ele]);a._targetIsland._pointSet.length=0;a._targetIsland._spinning.stop();a._targetIsland._wind.img=RES.getRES("wind4")}},100);a._isFly=!1}})},_water:null,die:function(a){var b=this,c=b._gc._stage_main,d=b._gc._stage_top,e=!1;clearInterval(b._gc._scene._eagle._interval);clearInterval(b._curIsland._floodInterval);switch(a){case 0:b._gc._scene._Bg.evtObject.destory();d.removeChild(b._bitmap);b._water=b._gc._panel.createBitmap("water",c,110/1135,b._curIsland._bitmap.x,b._curIsland._bitmap.y);b._water.anchorX=.57;b._water.anchorY=.58;KWhaleUtils.Tween(b._water,{y:b._curIsland._bitmap.y-c.sh/1135*40},0,300,TWEEN.Easing.Linear.None).start().onComplete(function(){e||(e=!0,b._gc.gameOver())});break;case 1:a=b._bitmap.y,b._bitmap.img=RES.getRES("sea_gull3"),KWhaleUtils.Tween(b._bitmap,{y:a+c.sh/1135*40},0,300,TWEEN.Easing.Linear.None).start().onComplete(function(){e||(e=!0,b._gc.gameOver())})}}};function Eagle(a){this._gc=a;this._targetPoint=this._curPoint=this._bitmap=null;this.init()}Eagle.prototype={_speed:3E3,_interval:null,init:function(){var a=this,b=a._gc._stage_top;a._bitmap=a._gc._panel.createBitmap("eagle1",b,117/1136,-b/1136*200,b.sh/1136*580);a.direction();a._interval=setInterval(function(){a.direction();a.fly();a._speed-=100},a._speed)},direction:function(){var a=this._gc._stage_top;.5<Math.random()?(this._curPoint={x:-this._bitmap.width/2},this._targetPoint={x:a.sw+this._bitmap.width/2},this._bitmap.scale=-1):(this._curPoint={x:a.sw+this._bitmap.width/2},this._targetPoint={x:-this._bitmap.width/2},this._bitmap.scale=1);this._bitmap.x=this._curPoint.x;this._bitmap.y=a.sh/1136*580},_flyAnimal:null,fly:function(){var a=this;a._flyAnimal=KWhaleUtils.Tween(a._bitmap,{x:a._targetPoint.x},0,1200,TWEEN.Easing.Linear.None).start().onUpdate(function(){var b=a._gc._scene._bird._bitmap.y,c=a._gc._scene._bird._bitmap.x,d=a._bitmap.y,e=a._bitmap.x,f=a._bitmap.width,g=a._bitmap.width;e-f/2<=c&&e+f/2>=c&&d-g/2<=b&&d+g/2>=b&&(a._flyAnimal.stop(),a._gc._scene._bird._flyBack?a._gc._scene._bird._flyBackAnimate.stop():a._gc._scene._bird._animateBird.stop(),a._gc._scene._bird.die(1))})}};